<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maintenance Checklists Repository · Demo</title>
  <meta name="description" content="Free proof-of-concept repository for maintenance checklists and procedures with search, preview, and download in JSON/CSV/XML." />
  <style>
    :root {
      --bg: #0b1220;
      --panel: #111a2b;
      --panel-2: #0e1726;
      --accent: #4f8cff;
      --text: #e6eefc;
      --muted: #a7b3cc;
      --border: #1f2a44;
      --success: #18c964;
      --warning: #f7b955;
      --danger: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#0a0f1a);color:var(--text)}
    header{position:sticky;top:0;z-index:50;background:rgba(11,18,32,.85);backdrop-filter: blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7cc7ff);box-shadow: var(--shadow)}
    h1{font-size:20px;margin:0}
    main{padding:20px 0}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .searchbar{display:flex;gap:10px;flex-wrap:wrap;padding:16px}
    input, select, button{border-radius:12px;border:1px solid var(--border);background:var(--panel-2);color:var(--text);padding:12px 14px;font-size:14px}
    input:focus, select:focus{outline:2px solid var(--accent)}
    .btn{cursor:pointer;transition:.2s ease;box-shadow: var(--shadow)}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#6aa7ff);border-color:transparent}
    .btn.ghost{background:transparent}
    .btn:hover{transform:translateY(-1px)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;padding:16px}
    .card{grid-column:span 12;background:var(--panel-2);border:1px solid var(--border);border-radius:16px;padding:16px;display:grid;grid-template-columns:1fr auto;gap:12px}
    @media(min-width:700px){.card{grid-column:span 6}}
    @media(min-width:1000px){.card{grid-column:span 4}}
    .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:12px}
    .tag{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0c1423}
    .title{font-weight:650;font-size:16px;margin-bottom:6px}
    .desc{color:#c9d6f5;font-size:13px;line-height:1.4;min-height:38px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .spacer{flex:1}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px}
    .badge.success{background:rgba(24,201,100,.12);color:#99f0bf;border:1px solid rgba(24,201,100,.35)}
    .badge.warning{background:rgba(247,185,85,.12);color:#ffe2b3;border:1px solid rgba(247,185,85,.35)}
    .small{font-size:12px;color:var(--muted)}
    footer{padding:32px 0;color:var(--muted)}
    .link{color:#b7d1ff;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.7);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{max-width:720px;width:100%;background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow)}
    .modal header{position:unset;background:transparent;border:0}
    .modal .content{padding:16px}
    ol.steps{margin:0;padding-left:18px}
    ol.steps li{margin:8px 0;padding-left:6px}
    .close-x{border:0;background:transparent;color:var(--muted);font-size:18px;cursor:pointer}

    /* empty state */
    .empty{padding:40px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
      <div class="brand"><div class="logo"></div><h1>Maintenance Checklists · Demo</h1></div>
      <a class="link small" href="#" id="exportAll">Export all (JSON)</a>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <div class="searchbar">
        <input id="q" placeholder="Search by name, asset, manufacturer, keyword…" style="flex:2"/>
        <select id="assetType" style="flex:1;min-width:180px">
          <option value="">All Asset Types</option>
        </select>
        <select id="frequency" style="flex:1;min-width:160px">
          <option value="">All Frequencies</option>
          <option>Daily</option>
          <option>Weekly</option>
          <option>Monthly</option>
          <option>Quarterly</option>
          <option>Semiannual</option>
          <option>Annual</option>
        </select>
        <button class="btn primary" id="applyFilters">Search</button>
        <button class="btn ghost" id="resetFilters">Reset</button>
      </div>
      <div class="grid" id="grid"></div>
      <div class="empty" id="emptyState" style="display:none">No results. Try different filters or keywords.</div>
    </section>

    <section style="margin-top:20px" class="small">
      <div class="panel" style="padding:16px">
        <b>About this demo</b> · Client-side only. All data is embedded and downloadable in multiple formats. Perfect for hosting on GitHub Pages / Netlify. Replace the sample data with your catalog and you have a working POC.
      </div>
    </section>
  </main>

  <footer class="container small">
    <div>© <span id="year"></span> Checklist Repository Demo · <a class="link" href="https://opensource.org/license/mit/" target="_blank">MIT License</a></div>
  </footer>

  <!-- MODAL -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true">
    <div class="modal">
      <header class="container" style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px">
        <div style="font-weight:650" id="modalTitle">Title</div>
        <button class="close-x" id="closeModal">✕</button>
      </header>
      <div class="content">
        <div id="modalMeta" class="meta" style="margin-bottom:8px"></div>
        <div class="desc" id="modalDesc" style="margin-bottom:12px"></div>
        <ol class="steps" id="modalSteps"></ol>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--border)">
        <button class="btn" id="dlJson">Download JSON</button>
        <button class="btn" id="dlCsv">Download CSV</button>
        <button class="btn" id="dlXml">Download XML</button>
      </div>
    </div>
  </div>

  <script>
    // --- SAMPLE DATA (replace with your catalog or fetch from a CMS/API) ---
    const DATA = [
      {
        id: "CL-000001",
        name: "Air Handling Unit (AHU) – Filter Change",
        asset_type: "Air Handling Unit",
        manufacturer: "Generic",
        frequency: "Monthly",
        standard_refs: ["ASHRAE 62.1", "OEM"],
        description: "Replace pre-filters and inspect frames and gaskets for air bypass.",
        steps: [
          "Lockout/tagout per site policy.",
          "Open access panels and inspect filter frames for damage.",
          "Remove pre-filters; bag and dispose per policy.",
          "Install new filters with airflow arrow aligned.",
          "Record differential pressure and reset alarm set-points.",
          "Restore equipment and log completion."
        ]
      },
      {
        id: "CL-000002",
        name: "MRI System – Weekly Safety/Function Check",
        asset_type: "MRI",
        manufacturer: "Siemens",
        frequency: "Weekly",
        standard_refs: ["ACR", "OEM"],
        description: "Verify basic system readiness, safety accessories, and room environmental checks.",
        steps: [
          "Check emergency quench button cover and signage.",
          "Inspect patient table motion and interlocks.",
          "Verify bore fan operation and airflow.",
          "Confirm RF coil physical condition and connectors.",
          "Review helium level and alarms if available.",
          "Document findings and escalate anomalies."
        ]
      },
      {
        id: "CL-000003",
        name: "Centrifuge – Quarterly Preventive Maintenance",
        asset_type: "Centrifuge",
        manufacturer: "Eppendorf",
        frequency: "Quarterly",
        standard_refs: ["CLSI", "OEM"],
        description: "Balance, rotor integrity, lubrication, and tach calibration spot-check.",
        steps: [
          "Disconnect power and remove rotor.",
          "Inspect rotor and buckets for stress or corrosion.",
          "Clean chamber; lubricate spindle per OEM.",
          "Check lid lock function and gasket condition.",
          "Run-up test to rated speed and verify vibration.",
          "Record tach reading vs. setpoint (± tolerance)."
        ]
      },
      {
        id: "CL-000004",
        name: "Emergency Generator – Monthly Test",
        asset_type: "Generator",
        manufacturer: "Caterpillar",
        frequency: "Monthly",
        standard_refs: ["NFPA 110", "OEM"],
        description: "Exercise generator under load, check fluids, and record parameters.",
        steps: [
          "Pre-start inspection (oil, coolant, fuel).",
          "Start and transfer to load bank or facility load.",
          "Operate for required duration per NFPA 110.",
          "Record voltage, frequency, and load %.",
          "Inspect for leaks; cool-down as required.",
          "Reset to standby; log runtime and findings."
        ]
      }
    ];

    // --- UTILITIES ---
    const el = (sel) => document.querySelector(sel);
    const fmt = (x) => Array.isArray(x) ? x.join(", ") : x || "—";
    const toCSV = (obj) => {
      // flat CSV for checklist and steps on separate rows (1 header)
      const rows = [];
      const base = {
        id: obj.id,
        name: obj.name,
        asset_type: obj.asset_type,
        manufacturer: obj.manufacturer,
        frequency: obj.frequency,
        standard_refs: (obj.standard_refs||[]).join("; "),
        description: obj.description
      };
      rows.push(["id","name","asset_type","manufacturer","frequency","standard_refs","step_number","step","description"]);
      obj.steps.forEach((s, i) => {
        rows.push([base.id, base.name, base.asset_type, base.manufacturer, base.frequency, base.standard_refs, i+1, s, base.description]);
      });
      return rows.map(r => r.map(v => '"'+String(v).replaceAll('"','""')+'"').join(",")).join("\n");
    };
    const toXML = (obj) => `<?xml version="1.0" encoding="UTF-8"?>\n<checklist id="${obj.id}">\n  <name>${escapeXml(obj.name)}</name>\n  <asset_type>${escapeXml(obj.asset_type)}</asset_type>\n  <manufacturer>${escapeXml(obj.manufacturer)}</manufacturer>\n  <frequency>${escapeXml(obj.frequency)}</frequency>\n  <standard_refs>${escapeXml((obj.standard_refs||[]).join(', '))}</standard_refs>\n  <description>${escapeXml(obj.description)}</description>\n  <steps>\n${obj.steps.map((s,i)=>`    <step number="${i+1}">${escapeXml(s)}</step>`).join("\n")}\n  </steps>\n</checklist>`;
    function escapeXml(s){return String(s).replace(/[<>&'\"]/g, c=>({"<":"&lt;",">":"&gt;","&":"&amp;","'":"&apos;","\"":"&quot;"}[c]))}
    function download(filename, mime, content){
      const blob = new Blob([content], {type: mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
    }

    // --- RENDER ---
    const grid = el('#grid');
    const empty = el('#emptyState');
    const assetFilter = el('#assetType');
    const freqFilter = el('#frequency');
    const q = el('#q');

    function distinct(list, key){
      return [...new Set(list.map(x => x[key]).filter(Boolean))];
    }

    function populateFilters(){
      distinct(DATA, 'asset_type').sort().forEach(t => {
        const o = document.createElement('option');
        o.value = t; o.textContent = t; assetFilter.appendChild(o);
      });
    }

    function matches(item, query){
      const s = (query||'').trim().toLowerCase();
      if(!s) return true;
      const hay = [item.name,item.asset_type,item.manufacturer,item.description,(item.standard_refs||[]).join(' ')].join(' ').toLowerCase();
      return hay.includes(s);
    }

    function apply(){
      const list = DATA.filter(x => (
        (!assetFilter.value || x.asset_type===assetFilter.value) &&
        (!freqFilter.value || x.frequency===freqFilter.value) &&
        matches(x, q.value)
      ));
      render(list);
    }

    function render(list){
      grid.innerHTML = '';
      if(list.length===0){empty.style.display='block';return} else empty.style.display='none';
      list.forEach(item => {
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
          <div>
            <div class="title">${item.name}</div>
            <div class="desc">${item.description}</div>
            <div class="meta" style="margin-top:8px">
              <span class="tag">${item.asset_type}</span>
              <span class="tag">${item.manufacturer || '—'}</span>
              <span class="tag">${item.frequency}</span>
              <span class="tag">Refs: ${fmt(item.standard_refs)}</span>
            </div>
          </div>
          <div class="row">
            <span class="badge success">Ready</span>
            <div class="spacer"></div>
            <button class="btn" data-action="preview">Preview</button>
            <div class="dropdown">
              <button class="btn" data-action="dl-json">JSON</button>
              <button class="btn" data-action="dl-csv">CSV</button>
              <button class="btn" data-action="dl-xml">XML</button>
            </div>
          </div>`;
        card.querySelector('[data-action="preview"]').addEventListener('click',()=>openModal(item));
        card.querySelector('[data-action="dl-json"]').addEventListener('click',()=>download(item.id+".json","application/json",JSON.stringify(item,null,2)));
        card.querySelector('[data-action="dl-csv"]').addEventListener('click',()=>download(item.id+".csv","text/csv",toCSV(item)));
        card.querySelector('[data-action="dl-xml"]').addEventListener('click',()=>download(item.id+".xml","application/xml",toXML(item)));
        grid.appendChild(card);
      });
    }

    // --- MODAL ---
    const backdrop = el('#backdrop');
    const modalTitle = el('#modalTitle');
    const modalDesc = el('#modalDesc');
    const modalMeta = el('#modalMeta');
    const modalSteps = el('#modalSteps');

    function openModal(item){
      modalTitle.textContent = item.name;
      modalDesc.textContent = item.description;
      modalMeta.innerHTML = '';
      [item.asset_type, item.manufacturer, item.frequency, `Refs: ${fmt(item.standard_refs)}`]
        .filter(Boolean)
        .forEach(t=>{
          const span = document.createElement('span');
          span.className='tag'; span.textContent=t; modalMeta.appendChild(span);
        });
      modalSteps.innerHTML='';
      item.steps.forEach((s,i)=>{
        const li = document.createElement('li');
        li.textContent = (i+1)+'. '+s; modalSteps.appendChild(li);
      });
      backdrop.style.display='flex';
      // bind download buttons for the selected item
      el('#dlJson').onclick = ()=>download(item.id+".json","application/json",JSON.stringify(item,null,2));
      el('#dlCsv').onclick = ()=>download(item.id+".csv","text/csv",toCSV(item));
      el('#dlXml').onclick = ()=>download(item.id+".xml","application/xml",toXML(item));
    }
    el('#closeModal').addEventListener('click',()=>backdrop.style.display='none');
    backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) backdrop.style.display='none'; });

    // --- EXPORT ALL ---
    el('#exportAll').addEventListener('click',(e)=>{
      e.preventDefault();
      download('checklists.json','application/json',JSON.stringify(DATA,null,2));
    });

    // --- FILTER HOOKS ---
    el('#applyFilters').addEventListener('click', apply);
    el('#resetFilters').addEventListener('click', ()=>{ q.value=''; assetFilter.value=''; freqFilter.value=''; apply(); });
    q.addEventListener('keydown', (e)=>{ if(e.key==='Enter') apply(); });

    // INIT
    document.addEventListener('DOMContentLoaded', ()=>{
      el('#year').textContent = new Date().getFullYear();
      populateFilters();
      apply();
    });
  </script>

  <!--
  =====================
  ServiceNow Integration (POC notes)
  =====================
  Option A (simple): Host this file on GitHub Pages. Your downloads are pure files generated client-side.
  Option B (API): Create a small Node/Express app with endpoints like /api/checklists and /api/checklists/:id
  Then point ServiceNow RESTMessageV2 to those endpoints.

  Example RESTMessageV2 (consumer) snippet:

  var r = new sn_ws.RESTMessageV2();
  r.setEndpoint('https://YOUR_PAGES_DOMAIN/checklists.json'); // or your API endpoint
  r.setHttpMethod('GET');
  var res = r.execute();
  var data = JSON.parse(res.getBody());
  // Insert into your scoped table (example)
  var gr = new GlideRecord('x_nuvo_eam_checklist_library');
  data.forEach(function(item){
    gr.initialize();
    gr.u_external_id = item.id;
    gr.u_name = item.name;
    gr.u_asset_type = item.asset_type;
    gr.u_description = item.description;
    gr.u_steps = JSON.stringify(item.steps);
    gr.insert();
  });

  -->
</body>
</html>
