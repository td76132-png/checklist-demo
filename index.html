<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maintenance Procedures · Demo</title>
  <meta name="description" content="Proof-of-concept website with a request form and a library of maintenance checklists & procedures.">
  <style>
    :root { --bg:#0b1220; --panel:#111a2b; --panel-2:#0e1726; --accent:#4f8cff; --text:#e6eefc; --muted:#a7b3cc; --border:#1f2a44; --shadow:0 10px 30px rgba(0,0,0,.25); --good:#18c964; --warn:#f7b955; --bad:#ff6b6b; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#0a0f1a);color:var(--text)}
    header{position:sticky;top:0;z-index:50;background:rgba(11,18,32,.85);backdrop-filter: blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7cc7ff);box-shadow:var(--shadow)}
    nav a{color:#cfe0ff;text-decoration:none;margin-left:16px;font-size:14px}
    nav a.active{color:#fff;border-bottom:2px solid var(--accent);padding-bottom:6px}
    main{padding:20px 0}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;padding:16px}
    .card{grid-column:span 12;background:var(--panel-2);border:1px solid var(--border);border-radius:16px;padding:16px}
    @media(min-width:700px){.card{grid-column:span 6}}
    @media(min-width:1000px){.card{grid-column:span 4}}
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:24px}
    .cta{display:flex;flex-direction:column;gap:8px;border-radius:16px;padding:20px;background:var(--panel-2);border:1px solid var(--border)}
    .cta h2{margin:0 0 6px 0}
    .cta p{margin:0;color:#c9d6f5}
    .btn{cursor:pointer;border-radius:12px;border:1px solid var(--border);background:var(--panel-2);color:var(--text);padding:12px 14px;font-size:14px;transition:.2s ease;box-shadow:var(--shadow)}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#6aa7ff);border-color:transparent}
    .btn:hover{transform:translateY(-1px)}
    input, select, textarea{width:100%;border-radius:12px;border:1px solid var(--border);background:var(--panel-2);color:var(--text);padding:12px 14px;font-size:14px}
    label{font-size:13px;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .small{font-size:12px;color:var(--muted)}
    .tag{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0c1423;color:#cfe0ff;font-size:12px}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}
    .searchbar{display:flex;gap:10px;flex-wrap:wrap;padding:12px 16px}
    [data-route]{display:none}
    [data-route].active{display:block}
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.7);display:none;align-items:center;justify-content:center;padding:20px}
    .modal{max-width:760px;width:100%;background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow)}
    .modal header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}
    .modal .content{padding:16px}
    .close-x{border:0;background:transparent;color:var(--muted);font-size:18px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
      <div class="brand"><div class="logo"></div><h1 style="font-size:20px;margin:0">Maintenance Procedures · Demo</h1></div>
      <nav>
        <a href="#/" data-link>Home</a>
        <a href="#/request" data-link>Request a New Procedure</a>
        <a href="#/library" data-link>Checklist & Procedure Library</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="panel" data-route="/">
      <div class="hero">
        <div class="cta">
          <h2>Request a New Procedure</h2>
          <p>Submit manufacturer/model details or attach OEM docs. We’ll structure a checklist for import.</p>
          <div style="margin-top:8px"><a class="btn primary" href="#/request">Go to Request Form →</a></div>
        </div>
        <div class="cta">
          <h2>Search the Library</h2>
          <p>Browse ready-to-use maintenance checklists & SOPs. Download or import to your CMMS/EAM.</p>
          <div style="margin-top:8px"><a class="btn primary" href="#/library">Open Library →</a></div>
        </div>
      </div>
      <div class="small" style="padding:0 24px 24px 24px">This is a static proof-of-concept. All data is stored locally in your browser (no server). Perfect for GitHub Pages.</div>
    </section>

    <section class="panel" data-route="/request">
      <div class="toolbar"><div style="font-weight:650">Request a New Procedure</div><a href="#/" class="small">← Back to Home</a></div>
      <div class="content" style="padding:16px">
        <form id="requestForm" class="grid" style="grid-template-columns:repeat(12,1fr);gap:16px">
          <div class="card" style="grid-column:span 12">
            <div class="row">
              <div>
                <label>Manufacturer</label>
                <input id="rq_mfr" placeholder="e.g., Siemens, Eppendorf" required>
              </div>
              <div>
                <label>Model</label>
                <input id="rq_model" placeholder="e.g., Magnetom Aera" required>
              </div>
            </div>
            <div class="row" style="margin-top:8px">
              <div>
                <label>UMDNS</label>
                <input id="rq_umdns" placeholder="e.g., 12-345 (optional)">
              </div>
              <div>
                <label>Asset Type</label>
                <input id="rq_asset_type" placeholder="e.g., MRI, Centrifuge, AHU" required>
              </div>
            </div>
            <div style="margin-top:8px">
              <label>Description</label>
              <textarea id="rq_desc" rows="4" placeholder="Describe what the procedure/checklist should cover…" required></textarea>
            </div>
            <div style="margin-top:8px">
              <label>Attach file (optional: .pdf, .docx, .jpg, .png)</label>
              <input id="rq_file" type="file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
              <div class="small">In this demo, attachments are not uploaded; the filename is stored with your request payload.</div>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn primary" type="submit">Submit Request</button>
              <button class="btn" type="reset">Reset</button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <section class="panel" data-route="/library">
      <div class="toolbar">
        <div style="display:flex;gap:8px;align-items:center"><span style="font-weight:650">Checklist & Procedure Library</span></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="addNew">Add New</button>
          <button class="btn" id="exportAll">Export All (JSON)</button>
          <label class="btn" for="importFile" style="cursor:pointer">Import JSON</label>
          <input id="importFile" type="file" accept="application/json" style="display:none">
        </div>
      </div>
      <div class="searchbar">
        <input id="q" placeholder="Search by name, asset, manufacturer, keyword…" style="flex:2"/>
        <select id="assetType" style="flex:1;min-width:180px"><option value="">All Asset Types</option></select>
        <select id="frequency" style="flex:1;min-width:160px">
          <option value="">All Frequencies</option>
          <option>Daily</option><option>Weekly</option><option>Monthly</option><option>Quarterly</option><option>Semiannual</option><option>Annual</option>
        </select>
        <button class="btn primary" id="applyFilters">Search</button>
        <button class="btn" id="resetFilters">Reset</button>
      </div>
      <div class="grid" id="grid"></div>
      <div class="small" id="emptyState" style="display:none;padding:12px 16px">No results. Try different filters or keywords.</div>
    </section>
  </main>

  <div class="modal-backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <header><div id="modalTitle" style="font-weight:650">Title</div><button class="close-x" id="closeModal">✕</button></header>
      <div class="content" id="modalBody"></div>
    </div>
  </div>

  <footer class="container small" style="padding:32px 0;color:var(--muted)">© <span id="year"></span> Maintenance Procedures Demo · MIT License</footer>

  <script>
    const STORAGE_KEY='CHECKLIST_DATA_V2';
    const seed=[
      {id:'CL-000001',name:'Air Handling Unit (AHU) – Filter Change',asset_type:'Air Handling Unit',manufacturer:'Generic',frequency:'Monthly',standard_refs:['ASHRAE 62.1','OEM'],description:'Replace pre-filters and inspect frames and gaskets for air bypass.',steps:['Lockout/tagout per site policy.','Open access panels and inspect filter frames for damage.','Remove pre-filters; bag and dispose per policy.','Install new filters with airflow arrow aligned.','Record differential pressure and reset alarm set-points.','Restore equipment and log completion.']},
      {id:'CL-000002',name:'MRI System – Weekly Safety/Function Check',asset_type:'MRI',manufacturer:'Siemens',frequency:'Weekly',standard_refs:['ACR','OEM'],description:'Verify basic system readiness, safety accessories, and room environmental checks.',steps:['Check emergency quench button cover and signage.','Inspect patient table motion and interlocks.','Verify bore fan operation and airflow.','Confirm RF coil physical condition and connectors.','Review helium level and alarms if available.','Document findings and escalate anomalies.']},
      {id:'CL-000003',name:'Centrifuge – Quarterly Preventive Maintenance',asset_type:'Centrifuge',manufacturer:'Eppendorf',frequency:'Quarterly',standard_refs:['CLSI','OEM'],description:'Balance, rotor integrity, lubrication, and tach calibration spot-check.',steps:['Disconnect power and remove rotor.','Inspect rotor and buckets for stress or corrosion.','Clean chamber; lubricate spindle per OEM.','Check lid lock function and gasket condition.','Run-up test to rated speed and verify vibration.','Record tach reading vs. setpoint (± tolerance).']},
      {id:'CL-000004',name:'Emergency Generator – Monthly Test',asset_type:'Generator',manufacturer:'Caterpillar',frequency:'Monthly',standard_refs:['NFPA 110','OEM'],description:'Exercise generator under load, check fluids, and record parameters.',steps:['Pre-start inspection (oil, coolant, fuel).','Start and transfer to load bank or facility load.','Operate for required duration per NFPA 110.','Record voltage, frequency, and load %.','Inspect for leaks; cool-down as required.','Reset to standby; log runtime and findings.']}
    ];
    const loadData=()=>JSON.parse(localStorage.getItem(STORAGE_KEY)||'null')||seed.slice();
    const saveData=(d)=>localStorage.setItem(STORAGE_KEY,JSON.stringify(d));

    const routes={'/':()=>showRoute('/'),'/request':()=>showRoute('/request'),'/library':()=>{showRoute('/library');initLibrary();}};
    function showRoute(p){document.querySelectorAll('[data-route]').forEach(s=>s.classList.remove('active'));const el=document.querySelector(`[data-route="${p}"]`);if(el)el.classList.add('active');document.querySelectorAll('nav a[data-link]').forEach(a=>{a.classList.toggle('active',a.getAttribute('href')===`#${p}`);});}

    const backdrop=document.getElementById('backdrop');
    const modalTitle=document.getElementById('modalTitle');
    const modalBody=document.getElementById('modalBody');
    function openModal(t,node){modalTitle.textContent=t;modalBody.innerHTML='';modalBody.appendChild(node);backdrop.style.display='flex';}
    function closeModal(){backdrop.style.display='none';}
    document.getElementById('closeModal').addEventListener('click',closeModal);
    backdrop.addEventListener('click',(e)=>{if(e.target===backdrop)closeModal();});

    const rqForm=document.getElementById('requestForm');
    if(rqForm){rqForm.addEventListener('submit',(e)=>{e.preventDefault();const payload={manufacturer:document.getElementById('rq_mfr').value.trim(),model:document.getElementById('rq_model').value.trim(),umdns:document.getElementById('rq_umdns').value.trim(),asset_type:document.getElementById('rq_asset_type').value.trim(),description:document.getElementById('rq_desc').value.trim(),attachment_name:document.getElementById('rq_file').files[0]?.name||null,submitted_at:new Date().toISOString()};const wrap=document.createElement('div');wrap.innerHTML='<div class="small" style="margin-bottom:8px">Your request has been prepared. In this demo, you can download it as JSON or copy it.</div>';const pre=document.createElement('pre');pre.style.whiteSpace='pre-wrap';pre.textContent=JSON.stringify(payload,null,2);const row=document.createElement('div');row.style.display='flex';row.style.gap='8px';row.style.marginTop='8px';const dl=document.createElement('button');dl.className='btn primary';dl.textContent='Download JSON';dl.onclick=()=>download('procedure_request.json','application/json',JSON.stringify(payload,null,2));const ok=document.createElement('button');ok.className='btn';ok.textContent='Done';ok.onclick=closeModal;row.appendChild(dl);row.appendChild(ok);wrap.appendChild(pre);wrap.appendChild(row);openModal('Request Prepared',wrap);rqForm.reset();});}

    let DATA=loadData();
    const grid=document.getElementById('grid');
    const empty=document.getElementById('emptyState');
    const assetFilter=document.getElementById('assetType');
    const freqFilter=document.getElementById('frequency');
    const q=document.getElementById('q');

    function distinct(list,key){return[...new Set(list.map(x=>x[key]).filter(Boolean))];}
    function populateFilters(){assetFilter.innerHTML='<option value="">All Asset Types</option>';distinct(DATA,'asset_type').sort().forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;assetFilter.appendChild(o);});}
    function matches(item,query){const s=(query||'').trim().toLowerCase();if(!s)return true;const hay=[item.name,item.asset_type,item.manufacturer,item.description,(item.standard_refs||[]).join(' ')].join(' ').toLowerCase();return hay.includes(s);}
    function apply(){const list=DATA.filter(x=>((!assetFilter.value||x.asset_type===assetFilter.value)&&(!freqFilter.value||x.frequency===freqFilter.value)&&matches(x,q.value)));render(list);}    
    function render(list){grid.innerHTML='';if(list.length===0){empty.style.display='block';return}else empty.style.display='none';list.forEach(item=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<div><div style="font-weight:650;font-size:16px;margin-bottom:6px">${item.name}</div><div style="color:#c9d6f5;font-size:13px;line-height:1.4;min-height:38px">${item.description}</div><div class="small" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"><span class="tag">${item.asset_type||'—'}</span><span class="tag">${item.manufacturer||'—'}</span><span class="tag">${item.frequency||'—'}</span><span class="tag">Refs: ${(item.standard_refs||[]).join(', ')||'—'}</span></div></div><div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end"><button class="btn" data-action="preview">Preview</button><button class="btn" data-action="edit">Edit</button><button class="btn" data-action="clone">Clone</button><button class="btn" data-action="dl-json">JSON</button><button class="btn" data-action="dl-csv">CSV</button><button class="btn" data-action="dl-xml">XML</button></div>`;card.querySelector('[data-action="preview"]').onclick=()=>previewItem(item);card.querySelector('[data-action="edit"]').onclick=()=>openEditor('Edit Procedure',item,(updated)=>{Object.assign(item,updated);persist();apply();});card.querySelector('[data-action="clone"]').onclick=()=>openEditor('Clone Procedure',{...item,id:newId()},(created)=>{DATA.push(created);persist();apply();});card.querySelector('[data-action="dl-json"]').onclick=()=>download(item.id+'.json','application/json',JSON.stringify(item,null,2));card.querySelector('[data-action="dl-csv"]').onclick=()=>download(item.id+'.csv','text/csv',toCSV(item));card.querySelector('[data-action="dl-xml"]').onclick=()=>download(item.id+'.xml','application/xml',toXML(item));grid.appendChild(card);});}
    function newId(){const max=DATA.reduce((m,x)=>{const n=parseInt(String(x.id).replace(/\D/g,''))||0;return Math.max(m,n);},0);return 'CL-'+String(max+1).padStart(6,'0');}
    function persist(){saveData(DATA);populateFilters();}
    function previewItem(item){const box=document.createElement('div');const meta=document.createElement('div');meta.style.display='flex';meta.style.gap='8px';meta.style.flexWrap='wrap';meta.style.marginBottom='8px';[item.asset_type,item.manufacturer,item.frequency,`Refs: ${(item.standard_refs||[]).join(', ')}`].filter(Boolean).forEach(t=>{const s=document.createElement('span');s.className='tag';s.textContent=t;meta.appendChild(s);});const desc=document.createElement('div');desc.textContent=item.description;desc.style.marginBottom='8px';const ol=document.createElement('ol');ol.style.margin='0';ol.style.paddingLeft='20px';(item.steps||[]).forEach((s,i)=>{const li=document.createElement('li');li.textContent=s;ol.appendChild(li);});const row=document.createElement('div');row.style.display='flex';row.style.gap='8px';row.style.marginTop='8px';const closeB=document.createElement('button');closeB.className='btn';closeB.textContent='Close';closeB.onclick=closeModal;const sn=document.createElement('button');sn.className='btn primary';sn.textContent='Download SN JSON';sn.onclick=()=>{const snPayload={checklist:{u_external_id:item.id,u_name:item.name,u_description:item.description,u_asset_type:item.asset_type||'',u_manufacturer:item.manufacturer||'',u_frequency:item.frequency||'',u_standard_refs:item.standard_refs||[]},steps:(item.steps||[]).map((s,i)=>({u_step_number:i+1,u_text:s}))};download(item.id+'_servicenow.json','application/json',JSON.stringify(snPayload,null,2));};row.appendChild(sn);row.appendChild(closeB);box.appendChild(meta);box.appendChild(desc);box.appendChild(ol);box.appendChild(row);openModal(item.name,box);}    
    function openEditor(title,item,onSave){const form=document.createElement('form');form.innerHTML=`<div class="row"><div><label>ID</label><input id="ed_id" value="${item.id||newId()}" required></div><div><label>Name</label><input id="ed_name" value="${item.name||''}" required></div></div><div class="row" style="margin-top:8px"><div><label>Asset Type</label><input id="ed_asset" value="${item.asset_type||''}"></div><div><label>Manufacturer</label><input id="ed_mfr" value="${item.manufacturer||''}"></div></div><div class="row" style="margin-top:8px"><div><label>Frequency</label><select id="ed_freq">${['','Daily','Weekly','Monthly','Quarterly','Semiannual','Annual'].map(f=>`<option ${f===(item.frequency||'')?'selected':''}>${f}</option>`).join('')}</select></div><div><label>Standard Refs (comma-separated)</label><input id="ed_refs" value="${(item.standard_refs||[]).join(', ')}"></div></div><div style="margin-top:8px"><label>Description</label><textarea id="ed_desc" rows="3">${item.description||''}</textarea></div><div style="margin-top:8px"><label>Steps (one per line)</label><textarea id="ed_steps" rows="6">${(item.steps||[]).join('\n')}</textarea></div><div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button type="button" class="btn" id="cancelEd">Cancel</button><button type="submit" class="btn primary">Save</button></div>`;form.onsubmit=(e)=>{e.preventDefault();const updated={id:document.getElementById('ed_id').value.trim(),name:document.getElementById('ed_name').value.trim(),asset_type:document.getElementById('ed_asset').value.trim(),manufacturer:document.getElementById('ed_mfr').value.trim(),frequency:document.getElementById('ed_freq').value,standard_refs:document.getElementById('ed_refs').value.split(',').map(s=>s.trim()).filter(Boolean),description:document.getElementById('ed_desc').value.trim(),steps:document.getElementById('ed_steps').value.split('\n').map(s=>s.trim()).filter(Boolean)};onSave(updated);closeModal();};form.querySelector('#cancelEd').onclick=closeModal;openModal(title,form);}    
    function download(filename,mime,content){const blob=new Blob([content],{type:mime});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;a.click();setTimeout(()=>URL.revokeObjectURL(url),500);}    
    function toCSV(obj){const rows=[];const base={id:obj.id,name:obj.name,asset_type:obj.asset_type,manufacturer:obj.manufacturer,frequency:obj.frequency,standard_refs:(obj.standard_refs||[]).join('; '),description:obj.description};rows.push(['id','name','asset_type','manufacturer','frequency','standard_refs','step_number','step','description']);(obj.steps||[]).forEach((s,i)=>{rows.push([base.id,base.name,base.asset_type,base.manufacturer,base.frequency,base.standard_refs,i+1,s,base.description]);});return rows.map(r=>r.map(v=>'"'+String(v).replaceAll('"','""')+'"').join(',')).join('\n');}
    function escapeXml(s){return String(s).replace(/[<>&'\"]/g,c=>({'<':'&lt;','>':'&gt;','&':'&amp;','\'':'&apos;','\"':'&quot;'}[c]))}
    function toXML(obj){return `<?xml version="1.0" encoding="UTF-8"?>\n<checklist id="${obj.id}">\n  <name>${escapeXml(obj.name)}</name>\n  <asset_type>${escapeXml(obj.asset_type||'')}</asset_type>\n  <manufacturer>${escapeXml(obj.manufacturer||'')}</manufacturer>\n  <frequency>${escapeXml(obj.frequency||'')}</frequency>\n  <standard_refs>${escapeXml((obj.standard_refs||[]).join(', '))}</standard_refs>\n  <description>${escapeXml(obj.description||'')}</description>\n  <steps>\n${(obj.steps||[]).map((s,i)=>`    <step number="${i+1}">${escapeXml(s)}</step>`).join('\n')}\n  </steps>\n</checklist>`}

    function initLibrary(){populateFilters();apply();document.getElementById('applyFilters').onclick=apply;document.getElementById('resetFilters').onclick=()=>{q.value='';assetFilter.value='';freqFilter.value='';apply();};q.onkeydown=(e)=>{if(e.key==='Enter')apply();};document.getElementById('exportAll').onclick=()=>download('checklists.json','application/json',JSON.stringify(DATA,null,2));document.getElementById('importFile').onchange=(e)=>{const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=()=>{try{const arr=JSON.parse(reader.result);if(Array.isArray(arr)){DATA=arr;persist();apply();}}catch(err){alert('Invalid JSON');}};reader.readAsText(file);};document.getElementById('addNew').onclick=()=>openEditor('Add New Procedure',{id:newId(),name:'',asset_type:'',manufacturer:'',frequency:'',standard_refs:[],description:'',steps:[]},(created)=>{DATA.push(created);persist();apply();});}

    function router(){const hash=location.hash.replace('#','')||'/';(routes[hash]?routes[hash]:routes['/'])();}
    window.addEventListener('hashchange',router);
    document.addEventListener('DOMContentLoaded',()=>{document.getElementById('year').textContent=new Date().getFullYear();router();});
  </script>
</body>
</html>
